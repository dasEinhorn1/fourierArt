<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Fourier Art</title>
    <script src="js/jquery.min.js"></script>
    <script src="js/p5.js"></script>
    <script src="js/p5.sound.min.js"></script>
    <script src="js/paper-full.min.js"></script>
    <script src="https://use.fontawesome.com/cd94f3602e.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Fjalla+One" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="css/main.css"/>
  </head>
  <body>
    <header>
      <div class="title-wrapper">
        <h1 class='title'>Fourier Art</h1>
        <h3 class="subtitle">Music visualizer</h3>
      </div>
      <ol class="navbar">
        <li><a href="docs.html">Docs</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="index.html">Visualizer</a></li>
      </ol>
    </header>
    <main>
      <div id='load-screen' style='display:none;'>
        <img src="media/Infinity.svg" alt="loading"/>
      </div>

      <div id='q-menu-popup' class='btn'>Show controls</div>

      <!--Two.js applies to div below-->
      <canvas id="visualizer" resize="true"></canvas>

      <!--All UI for controlling visualization-->
      <div id="vis-menu"  style="display:none">
        <div class=".float-container">
          <h1 style='float:left'>Queue</h1>
          <div class="close-wrap">
            <div class="btn close-btn" data-hide='#vis-menu'
              data-show='#q-menu-popup'></div>
          </div>
        </div>
        <div id='queue' class="submenu">
          <div id = 'queue-controls'>
            <button class='btn btn-block circle' type="button" id="add-song">
              <i class="fa fa-plus" aria-hidden="true"></i>
            </button>
            <button class='btn btn-block' type="button" name="reorder">Edit</button>
            <button class='btn btn-block' type="button" name="remove-all">Remove</button>
          </div>
          <div class="playlist-wrapper">
            <table class='playlist'>
              <tr class='playlist-header'>
                <th>
                  <i class="fa fa-volume-up" aria-hidden="true"
                    style='visibility:hidden'></i>
                </th>
                <th>Song Title</th>
                <th>Duration</th>
              </tr>
            </table>
          </div>
          <div class="controls-wrap">
            <div class="controls">
              <button class='btn btn-block shuffle' type="button" name="loop">
                <i class="fa fa-random" aria-hidden="true"></i>
              </button>
              <button class='btn btn-block prev-song' type="button" name="next">
                <i class="fa fa-step-backward" aria-hidden="true"></i>
              </button>
              <div class='btn btn-block circle play-pause'>
                <i class="fa fa-pause" aria-hidden="true"></i>
                <i class="fa fa-play" aria-hidden="true" style='display:none'></i>
              </div>
              <button class='btn btn-block next-song' type="button" name="next">
                <i class="fa fa-step-forward" aria-hidden="true"></i>
              </button>
              <button class='btn btn-block repeat' type="button" name="loop">
                <i class="fa fa-retweet" aria-hidden="true"></i>
              </button>
            </div>
          </div>
          <div class="time-bar-wrap">
            <div class="time time-current">0:00s</div>
            <div class="progress-bar-wrap">
              <div class="progress-bar"></div>
            </div>
            <div class="time time-left">0:00s</div>
          </div>
        </div>
    </div>
    <div class="pop-out-wrapper">
      <div id="song-add" class="pop-out center">
        <div class="close-wrap">
          <div class="btn close-btn" data-hide='.pop-out-wrapper'>x</div>
        </div>
        <div class="">
          <label for="sound-file" class='btn btn-file'>
            Upload a song
            <i class='fa fa-upload'></i>
          </label>
          <input id="song-file-input" class='file-input'
            type="file" name="sound-file" multiple='false'/>
        </div>
        <p>&mdash; or &mdash;</p>
        <div class='sound-link-wrap'>
          <!-- <label for="sound-link">Enter a Url:</label> -->
          <div class="link-box-wrap">
            <input id="link-input" type="text" name="sound-link"
              placeholder="Enter a URL"/>
          </div>
          <button id='link-input-btn' class="btn" type="button" name="button">
            <i class='fa fa-arrow-right'></i>
          </button>
        </div>
      </div>
    </div>

    </main>
    <footer>

    </footer>
    <script src="js/player.js"></script>
    <script src="js/fourier.js"></script>
    <script type="text/paperscript" src="js/main.js" canvas="visualizer"></script>
  </body>
  <script type="text/javascript">
    $('#song-file-input').change( function(event) {
      $.each(event.target.files, function(k,v) {
        var tmppath = URL.createObjectURL(v);
        q.addSong(tmppath, function(){}, v.name);
      });
    });

    $(window).on('keydown', function(e) {
      console.log(e.which);
      if (e.which == KEYS.SPACE) {
        var play = playButtonUpdate();
        if (play) {
          q.pause();
        } else {
          q.play();
        }
      } else if (e.which == KEYS.LEFT) {
        q.previous();
      } else if (e.which == KEYS.RIGHT) {
        q.next();
      } else if (e.which == KEYS.Q) {
        if ($('#vis-menu').css('display') == 'none') {
          $('#vis-menu').css('display', 'block');
          $('#q-menu-popup').css('display','none');
        } else {
          $('#vis-menu').css('display','none');
          $('#q-menu-popup').css('display', 'block');
        }
      } else if (e.which == KEYS.R) {
        $('.repeat').toggleClass('selected');
        q.toggleRepeat();
      } else if (e.which == KEYS.A) {
        if ($('.pop-out-wrapper').css('display') == 'none') {
          $('.pop-out-wrapper').css('display', 'block');
        } else {
          $('.pop-out-wrapper').css('display', 'none');
        }
      } else if (e.which == KEYS.ESC) {
        $('.close-btn').click()
      }
    });

    $(".btn-file").click(function(e) {
      $('#song-file-input').click();
    });

    $('#link-input-btn').click(function(e) {
        q.addSong($('#link-input').val(), function(){});
    });

    $('#link-input').on('keypress', function(event) {
      event.stopPropagation();
      if (event.which == KEYS.ENTER) {
        console.log("adding");
        q.addSong(event.target.value, function(){});
      }
    })

    $(".next-song").click(function(e) {
      q.next();
    });
    $(".prev-song").click(function(e) {
      q.previous();
    });

    $('.repeat').click(function(e) {
      $(e.currentTarget).toggleClass('selected');
      q.toggleRepeat();
    });

    $(".play-pause").click(function(e) {
      var play = playButtonUpdate();
      if (play) {
        q.pause();
      } else {
        q.play();
      }
    });

    $(".close-btn").click(function(e) {
      var hide = e.target.dataset.hide;
      var show = e.target.dataset.show;
      $(hide).css('display', 'none');
      if (show) {
        $(show).css('display', 'block')
      }
    })

    $("#add-song").click(function(e) {
      $('.pop-out-wrapper').css('display', 'block');
    })

    $('#q-menu-popup').click(function(e){
      $(e.currentTarget).css('display', 'none');
      $('#vis-menu').css('display', 'block');
    });

    $('.playlist').on('dblclick', '.song', function(e) {
      var newId = e.currentTarget.dataset.id;
      if(q.changing || q.isPlayingById(newId)) return;
      //q.changing = true;
      q.changeSong(newId, function(){
        q.changing=false;
      });
    });

  </script>
</html>
